<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<style type="text/css">
		body, html {width: 100%;height: 100%;margin:0;font-family:"微软雅黑";}
		#allmap{width:100%;height:90%;}
		#r-result{width:100%;}
	</style>
	<script type="text/javascript" src="http://api.map.baidu.com/api?v=3.0&ak=<#config name='map.ak'/>"></script>
	<!--<script type="text/javascript" src="http://api.map.baidu.com/library/TextIconOverlay/1.2/src/TextIconOverlay_min.js"></script>-->
	<!--<script type="text/javascript" src="http://api.map.baidu.com/library/MarkerClusterer/1.2/src/MarkerClusterer_min.js"></script>-->
	<!--<script type="text/javascript" src="http://api.map.baidu.com/library/RichMarker/1.2/src/RichMarker_min.js"></script>-->
	<script type="text/javascript" src="http://api.map.baidu.com/library/InfoBox/1.2/src/InfoBox_min.js"></script>
	<script type="text/javascript" src="${contextPath}/resources/js/TextIconOverlay_min.js"></script>
	<script type="text/javascript" src="${contextPath}/resources/js/MarkerClusterer.min.js"></script>
	<title>点聚合</title>
</head>
<body>
<div id="allmap"></div>
<div id="r-result">
	<input type="button" onclick="add_overlay();" value="添加点聚合" />
	<input type="button" onclick="remove_overlay();" value="重新生成点聚合" />
</div>
</body>
</html>
<script type="text/javascript">

    //百度地图API功能
    //    function loadJScript() {
    //        var script = document.createElement("script");
    //        script.type = "text/javascript";
    //        script.src = "http://api.map.baidu.com/api?v=2.0&ak=<#config name='map.ak'/>&callback=init";
    //        document.body.appendChild(script);
    //    }
    // 百度地图API功能
    var map = new BMap.Map("allmap");
    //哈尔滨
    var lat = 126.608858;
    var lng = 45.709509;
    map.centerAndZoom(new BMap.Point(lat,lng), 13);
    map.enableScrollWheelZoom();
    var MAX = 1000;
    var markers = [];
    var myIcon = new BMap.Icon("${contextPath}/resources/images/icon/pos-icon.png", new BMap.Size(23, 25), {
        // 指定定位位置。
        // 当标注显示在地图上时，其所指向的地理位置距离图标左上
        // 角各偏移7像素和20像素。
        anchor: new BMap.Size(7, 20)
    });
    //        第三方InfoBox时保存上次打开的窗口
    var infoBoxTemp = null;
    for (var i = 0; i < MAX; i++) {
        var pt = new BMap.Point(Math.random()/5+lat-0.1, Math.random()/5+lng-0.1);
        var marker = new BMap.Marker(pt, {icon: myIcon});
        //绑定自定义属性
        marker.meta={id:i, name:"客户"+i};
        map.addOverlay(marker);
        //标签显示在图标下方
        var label = new window.BMap.Label("客户", { offset: new window.BMap.Size(-10, 25) });
        label.setStyle({border:'0px',background: "transparent none repeat"});
        marker.setLabel(label);
        //鼠标悬停时显示
        marker.setTitle(marker.meta.name);
//        marker.enableDragging();

        marker.addEventListener("onclick", function(e){
            //默认infoWindow用法
//			var opts = {
//				width : 250,     // 信息窗口宽度
//				height: 100,     // 信息窗口高度
//				title : "Hello"+this.meta.name // 信息窗口标题
//			}
//			var infoWindow = new BMap.InfoWindow("<B>"+this.meta.name+"</B>", opts);  // 创建信息窗口对象
//			this.openInfoWindow(infoWindow);

            //第三方InfoBox用法
            if (infoBoxTemp) {
                infoBoxTemp.close();
            }
            var content = [
                '<iframe scrolling="auto" frameborder="0" src="'
                ,'http://crmweb.diligrp.com:8085/customerVisit/index.html'
                ,'" onLoad="" style="width:100%; height: 99.2%;"></iframe>'
            ];
            var infoBox = new BMapLib.InfoBox(map, content.join(""), {
                boxStyle:{
                    background: "white none repeat scroll 0% 0%",
                    // background:"url('${contextPath}/resources/images/bg.png') no-repeat center top",
                    width: "270px"
                    ,height: "300px"
                }
                ,closeIconMargin: "1px 1px 0 0"
                ,offset: new BMap.Size(0, 18)
                ,closeIconUrl:"${contextPath}/resources/images/login-user.png"
                ,enableAutoPan: true
                ,align: INFOBOX_AT_TOP
            });
            infoBoxTemp = infoBox;
            infoBox.open(this);
        });
        markers.push(marker);
    }

    //最简单的用法，生成一个marker数组，然后调用markerClusterer类即可。
    var markerClusterer = new BMapLib.MarkerClusterer(map, {markers:markers});


</script>